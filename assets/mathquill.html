<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./mathquill.css" />
    <script src="jquery-3.7.1.min.js"></script>
    <script src="mathquill.min.js"></script>
    <script>
      window.onerror = function (msg, url, lineNo, columnNo, error) {
        window.ReactNativeWebView.postMessage(
          "JS Error: " + msg + " at " + url + ":" + lineNo
        );
        return false;
      };
      var MQ;
      function initMathQuill(initialLatex = "") {
        try {
          if (!window.MathQuill) {
            window.ReactNativeWebView.postMessage(
              "Error: MathQuill not loaded"
            );
            return;
          }
          MQ = MathQuill.getInterface(2);
          const field = document.getElementById("math-field");
          if (!field) {
            window.ReactNativeWebView.postMessage(
              "Error: #math-field not found"
            );
            return;
          }
          field.innerHTML = "Initializing...";
          const mathField = MQ.MathField(field, {
            spaceBehavesLikeTab: true,
            handlers: {
              edit: function () {
                window.ReactNativeWebView.postMessage(
                  "Edit: " + mathField.latex()
                );
              },
              enter: function () {
                window.ReactNativeWebView.postMessage(
                  "Enter: " + mathField.latex()
                );
              },
            },
          });
          if (initialLatex) {
            try {
              mathField.latex(initialLatex);
              window.ReactNativeWebView.postMessage(
                "Set LaTeX: " + initialLatex
              );
            } catch (e) {
              window.ReactNativeWebView.postMessage(
                "LaTeX set error: " + e.message
              );
            }
          } else {
            window.ReactNativeWebView.postMessage("No initial LaTeX provided");
          }
        } catch (e) {
          window.ReactNativeWebView.postMessage(
            "MathQuill init error: " + e.message
          );
        }
      }
    </script>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: sans-serif;
        background: white;
      }
      #math-field {
        width: 100%;
        height: 100px;
        border: 1px solid #ccc;
        font-size: 1.2em;
      }
    </style>
  </head>
  <body onload="initMathQuill()">
    <div id="math-field"></div>
  </body>
</html>
